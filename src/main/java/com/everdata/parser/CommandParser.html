<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
<TITLE>BNF for CommandParser.jj</TITLE>
</HEAD>
<BODY>
<H1 ALIGN=CENTER>BNF for CommandParser.jj</H1>
<H2 ALIGN=CENTER>TOKENS</H2>
<TABLE>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/*****************************************************************************\
 * Lexical Analysis
\*****************************************************************************/</PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; SKIP : {
" "
| "\f"
| "\t"
| "\r"
| "\n"
}

   </PRE>
  </TD>
 </TR>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/*
 *  Prefix   Meaning
 * ---------------------
 *  K_       Keyword
 *  O_       Operator
 *  S_       Substitute
 */</PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; TOKEN : {
&lt;K_AND: "AND"&gt;
| &lt;K_SEARCH: "SEARCH"&gt;
| &lt;K_COUNTFIELD: "COUNTFIELD"&gt;
| &lt;K_LIMIT: "LIMIT"&gt;
| &lt;K_OTHERSTR: "OTHERSTR"&gt;
| &lt;K_PERCENTFIELD: "PERCENTFIELD"&gt;
| &lt;K_SHOWCOUNT: "SHOWCOUNT"&gt;
| &lt;K_SHOWPERC: "SHOWPERC"&gt;
| &lt;K_USEOTHER: "USEROTHER"&gt;
| &lt;K_TIMEFORMAT: "TIMEFORMAT"&gt;
| &lt;K_STARTTIME: "STARTTIME"&gt;
| &lt;K_ENDTIME: "ENDTIME"&gt;
| &lt;K_EARLIEST: "EARLIEST"&gt;
| &lt;K_LATEST: "LATEST"&gt;
| &lt;K_MINCOUNT: "MINCOUNT"&gt;
| &lt;K_SOURCETYPE: "SOURCETYPE"&gt;
| &lt;K_TOP: "TOP"&gt;
| &lt;K_BY: "BY"&gt;
| &lt;K_CREATE: "CREATE"&gt;
| &lt;K_DELETE: "DELETE"&gt;
| &lt;K_DESC: "DESC"&gt;
| &lt;K_ASC: "ASC"&gt;
| &lt;K_DESCRIBE: "DESCRIBE"&gt;
| &lt;K_DISTINCT: "DISTINCT"&gt;
| &lt;K_DROP: "DROP"&gt;
| &lt;K_EXPLAIN: "EXPLAIN"&gt;
| &lt;K_HELP: "HELP"&gt;
| &lt;K_FLOAT: "FLOAT"&gt;
| &lt;K_FROM: "FROM"&gt;
| &lt;K_INDEX: "INDEX"&gt;
| &lt;K_INSERT: "INSERT"&gt;
| &lt;K_INTEGER: "INTEGER"&gt;
| &lt;K_INTO: "INTO"&gt;
| &lt;K_ON: "ON"&gt;
| &lt;K_OR: "OR"&gt;
| &lt;K_NOT: "NOT"&gt;
| &lt;K_ORDER: "ORDER"&gt;
| &lt;K_QUIT: "QUIT"&gt;
| &lt;K_SELECT: "SELECT"&gt;
| &lt;K_SET: "SET"&gt;
| &lt;K_STRING: "STRING"&gt;
| &lt;K_STATS: "STATS"&gt;
| &lt;K_TABLE: "TABLE"&gt;
| &lt;K_UPDATE: "UPDATE"&gt;
| &lt;K_VALUES: "VALUES"&gt;
| &lt;K_WHERE: "WHERE"&gt;
| &lt;K_HASCHILD: "HASCHILD"&gt;
| &lt;K_HASPARENT: "HASPARENT"&gt;
| &lt;K_SUM: "SUM"&gt;
| &lt;K_DC: "DC"&gt;
| &lt;K_MIN: "MIN"&gt;
| &lt;K_MAX: "MAX"&gt;
| &lt;K_AVG: "AVG"&gt;
| &lt;K_EVAL: "EVAL"&gt;
| &lt;K_COUNT: "COUNT"&gt;
| &lt;K_AS: "AS"&gt;
| &lt;K_REGEX: "REGEX"&gt;
| &lt;K_SORT: "SORT"&gt;
| &lt;K_JOIN: "JOIN"&gt;
| &lt;K_SPAN: "SPAN"&gt;
| &lt;K_TIMESPAN: "TIMESPAN"&gt;
| &lt;K_COUNTORDER: "COUNTORDER"&gt;
}

   </PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; TOKEN : {
&lt;O_EQ: "="&gt;
| &lt;O_NEQ: "!="&gt;
| &lt;O_GT: "&gt;"&gt;
| &lt;O_GTE: "&gt;="&gt;
| &lt;O_LT: "&lt;"&gt;
| &lt;O_LTE: "&lt;="&gt;
| &lt;O_LPAREN: "("&gt;
| &lt;O_RPAREN: ")"&gt;
| &lt;O_COMMA: ","&gt;
| &lt;O_SEMI: ";"&gt;
| &lt;O_QUOTE: "\""&gt;
| &lt;O_VERTICAL: "|"&gt;
}

   </PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; TOKEN : {
&lt;S_CHINESE: (&lt;CJK&gt;)+ (&lt;CJK&gt;)*&gt;
| &lt;#CJK: ["\u3040"-"\u318f","\u3300"-"\u337f","\u3400"-"\u3d2d","\u4e00"-"\u9fff","\uf900"-"\ufaff"]&gt;
}

   </PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; TOKEN : {
&lt;S_INTEGER: ("-")? (&lt;DIGIT&gt;)+&gt;
| &lt;#DIGIT: ["0"-"9"]&gt;
| &lt;S_FLOAT: ("-")? (&lt;S_INTEGER&gt;)? "." &lt;S_INTEGER&gt;&gt;
}

   </PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; TOKEN : {
&lt;S_IDENTIFIER: (&lt;DIGIT&gt; | &lt;LETTER&gt; | &lt;SPECIAL_CHAR&gt;)+&gt;
| &lt;#LETTER: ["a"-"z","A"-"Z"]&gt;
| &lt;#SPECIAL_CHAR: "$" | "_" | "/" | "+" | "-" | "*" | "?" | ":" | "."&gt;
| &lt;S_QUOTED_STRING: "\"" (~["\""])* "\""&gt;
| &lt;S_SINGLE_QUOTED_STRING: "\'" (~["\'"])* "\'"&gt;
}

   </PRE>
  </TD>
 </TR>
 <!-- Token -->
 <TR>
  <TD>
   <PRE>
&lt;DEFAULT&gt; SPECIAL : {
&lt;LINE_COMMENT: "--" (~["\r","\n"])*&gt;
| &lt;MULTI_LINE_COMMENT: "/*" (~["*"])* "*" ("*" | ~["*","/"] (~["*"])* "*")* "/"&gt;
}

   </PRE>
  </TD>
 </TR>
</TABLE>
<H2 ALIGN=CENTER>NON-TERMINALS</H2>
<TABLE>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/*****************************************************************************\
 * Top-Level Statements
\*****************************************************************************/</PRE>
  </TD>
 </TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod1">Start</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE><A HREF="#prod2">SearchStatement</A> ( &lt;O_VERTICAL&gt; ( <A HREF="#prod3">JoinStatement</A> | <A HREF="#prod4">StatsStatement</A> | <A HREF="#prod5">SortStatement</A> | <A HREF="#prod6">TableStatement</A> ) )* &lt;EOF&gt;</TD>
</TR>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/* table <wc-field-list> */</PRE>
  </TD>
 </TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod6">TableStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_TABLE&gt; <A HREF="#prod7">FieldList</A></TD>
</TR>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/*join <field-list> [ subsearch ]*/</PRE>
  </TD>
 </TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod3">JoinStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_JOIN&gt; <A HREF="#prod7">FieldList</A> &lt;O_LPAREN&gt; <A HREF="#prod2">SearchStatement</A> &lt;O_RPAREN&gt;</TD>
</TR>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/*sort [<count>] (<sort-by-clause>)+ [desc]*/</PRE>
  </TD>
 </TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod5">SortStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_SORT&gt; ( &lt;S_INTEGER&gt; )? &lt;S_IDENTIFIER&gt; ( &lt;K_DESC&gt; | &lt;K_ASC&gt; )? ( &lt;O_COMMA&gt; &lt;S_IDENTIFIER&gt; ( &lt;K_DESC&gt; | &lt;K_ASC&gt; )? )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod8">RegexStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_REGEX&gt; ( ( &lt;S_IDENTIFIER&gt; &lt;O_EQ&gt; &lt;S_QUOTED_STRING&gt; ) | &lt;S_QUOTED_STRING&gt; )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod4">StatsStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_STATS&gt; ( &lt;K_MINCOUNT&gt; &lt;O_EQ&gt; &lt;S_INTEGER&gt; ( &lt;O_COMMA&gt; &lt;S_INTEGER&gt; )* | &lt;K_LIMIT&gt; &lt;O_EQ&gt; &lt;S_INTEGER&gt; ( &lt;O_COMMA&gt; &lt;S_INTEGER&gt; )* | &lt;K_SPAN&gt; &lt;O_EQ&gt; &lt;S_INTEGER&gt; ( &lt;O_COMMA&gt; &lt;S_INTEGER&gt; )* | &lt;K_TIMESPAN&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; ( &lt;O_COMMA&gt; &lt;S_IDENTIFIER&gt; )* )? <A HREF="#prod9">StatsFunction</A> ( &lt;O_COMMA&gt; <A HREF="#prod9">StatsFunction</A> )* ( <A HREF="#prod10">ByClause</A> )?</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod9">StatsFunction</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( &lt;K_COUNT&gt; | &lt;K_SUM&gt; | &lt;K_DC&gt; | &lt;K_MAX&gt; | &lt;K_MIN&gt; | &lt;K_AVG&gt; ) &lt;O_LPAREN&gt; ( &lt;S_IDENTIFIER&gt; | &lt;S_QUOTED_STRING&gt; ) &lt;O_RPAREN&gt; ( &lt;K_AS&gt; &lt;S_IDENTIFIER&gt; )? ( &lt;K_DESC&gt; | &lt;K_ASC&gt; )?</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod11">EvalExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_EVAL&gt; &lt;O_LPAREN&gt; &lt;S_QUOTED_STRING&gt; &lt;O_RPAREN&gt;</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod12">DeleteStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_DELETE&gt;</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod7">FieldList</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;S_IDENTIFIER&gt; ( &lt;O_COMMA&gt; &lt;S_IDENTIFIER&gt; )*</TD>
</TR>
 <!-- Special token -->
 <TR>
  <TD>
<PRE>
/*
void TopStatement() #_Top : {}
{
  <K_TOP> (LOOKAHEAD(2)TopOption())* FieldList() [ ByClause() ]
}
void TopOption() #_TopOption : {}
{

  <K_COUNTFIELD> <O_EQ> <S_IDENTIFIER> {jjtThis.opt.type = Option.COUNTFIELD; jjtThis.opt.value = token.image;}
  | 
  <K_LIMIT> <O_EQ> <S_INTEGER>  {jjtThis.opt.type = Option.LIMIT; jjtThis.opt.value = token.image;}
  | 
  <K_OTHERSTR> <O_EQ> <S_IDENTIFIER>  {jjtThis.opt.type = Option.OTHERSTR; jjtThis.opt.value = token.image;}
  | 
  <K_PERCENTFIELD> <O_EQ> <S_IDENTIFIER>  {jjtThis.opt.type = Option.PERCENTFIELD; jjtThis.opt.value = token.image;}
  | 
  <K_SHOWCOUNT> <O_EQ> <S_IDENTIFIER>  {jjtThis.opt.type = Option.SHOWCOUNT; jjtThis.opt.value = token.image;}
  | 
  <K_SHOWPERC> <O_EQ> <S_IDENTIFIER>  {jjtThis.opt.type = Option.SHOWPERC; jjtThis.opt.value = token.image;}
  | 
  <K_USEOTHER> <O_EQ> <S_IDENTIFIER> {jjtThis.opt.type = Option.USEOTHER; jjtThis.opt.value = token.image;}
  |
  <K_MINCOUNT> <O_EQ> <S_INTEGER> {jjtThis.opt.type = Option.MINCOUNT; jjtThis.opt.value = token.image;}
  
}
*/</PRE>
  </TD>
 </TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod10">ByClause</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_BY&gt; ( &lt;K_EVAL&gt; &lt;O_LPAREN&gt; &lt;S_QUOTED_STRING&gt; &lt;O_RPAREN&gt; | &lt;S_IDENTIFIER&gt; ) ( &lt;K_COUNTORDER&gt; )? ( &lt;K_DESC&gt; | &lt;K_ASC&gt; )? ( &lt;O_COMMA&gt; ( &lt;K_EVAL&gt; &lt;O_LPAREN&gt; &lt;S_QUOTED_STRING&gt; &lt;O_RPAREN&gt; | &lt;S_IDENTIFIER&gt; ) ( &lt;K_COUNTORDER&gt; )? ( &lt;K_DESC&gt; | &lt;K_ASC&gt; )? )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod2">SearchStatement</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;K_SEARCH&gt; ( <A HREF="#prod13">SearchOption</A> )* ( <A HREF="#prod14">BooleanExpression</A> )?</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod14">BooleanExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE><A HREF="#prod15">AndExpression</A> ( &lt;K_OR&gt; <A HREF="#prod15">AndExpression</A> )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod15">AndExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE><A HREF="#prod16">UnaryExpression</A> ( &lt;K_AND&gt; <A HREF="#prod16">UnaryExpression</A> )*</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod16">UnaryExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( &lt;K_NOT&gt; )? ( &lt;O_LPAREN&gt; <A HREF="#prod14">BooleanExpression</A> &lt;O_RPAREN&gt; | <A HREF="#prod17">PredicateExpression</A> )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod13">SearchOption</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( &lt;K_HASCHILD&gt; &lt;O_EQ&gt; &lt;O_LPAREN&gt; &lt;K_SOURCETYPE&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; <A HREF="#prod14">BooleanExpression</A> &lt;O_RPAREN&gt; | &lt;K_HASPARENT&gt; &lt;O_EQ&gt; &lt;O_LPAREN&gt; &lt;K_SOURCETYPE&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; <A HREF="#prod14">BooleanExpression</A> &lt;O_RPAREN&gt; | &lt;K_TIMEFORMAT&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; | &lt;K_STARTTIME&gt; &lt;O_EQ&gt; ( &lt;S_IDENTIFIER&gt; | &lt;S_QUOTED_STRING&gt; ) | &lt;K_ENDTIME&gt; &lt;O_EQ&gt; ( &lt;S_IDENTIFIER&gt; | &lt;S_QUOTED_STRING&gt; ) | &lt;K_EARLIEST&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; | &lt;K_LATEST&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; | &lt;K_SOURCETYPE&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; ( &lt;O_COMMA&gt; &lt;S_IDENTIFIER&gt; )* | &lt;K_INDEX&gt; &lt;O_EQ&gt; &lt;S_IDENTIFIER&gt; ( &lt;O_COMMA&gt; &lt;S_IDENTIFIER&gt; )* )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod17">PredicateExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( <A HREF="#prod18">ComparisonExpression</A> ( <A HREF="#prod18">ComparisonExpression</A> | <A HREF="#prod19">TermExpression</A> )* | <A HREF="#prod19">TermExpression</A> ( <A HREF="#prod18">ComparisonExpression</A> | <A HREF="#prod19">TermExpression</A> )* )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod19">TermExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>( ( &lt;S_INTEGER&gt; | &lt;S_FLOAT&gt; | &lt;S_IDENTIFIER&gt; ) | &lt;S_QUOTED_STRING&gt; )</TD>
</TR>
<TR>
<TD ALIGN=RIGHT VALIGN=BASELINE><A NAME="prod18">ComparisonExpression</A></TD>
<TD ALIGN=CENTER VALIGN=BASELINE>::=</TD>
<TD ALIGN=LEFT VALIGN=BASELINE>&lt;S_IDENTIFIER&gt; ( &lt;O_EQ&gt; | &lt;O_NEQ&gt; | &lt;O_GT&gt; | &lt;O_GTE&gt; | &lt;O_LT&gt; | &lt;O_LTE&gt; ) ( ( &lt;S_INTEGER&gt; | &lt;S_FLOAT&gt; | &lt;S_IDENTIFIER&gt; ) | &lt;S_QUOTED_STRING&gt; )</TD>
</TR>
</TABLE>
</BODY>
</HTML>